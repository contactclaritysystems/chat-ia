<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Chat IA</title>
  <style>
    body { font-family: Arial; background:#f5f5f5; }
    #chat { max-width:600px; margin:40px auto; background:#fff; padding:20px; border-radius:8px; }
    .msg { margin-bottom:10px; }
    .user { font-weight:bold; }
    .ia { color:#333; }
  </style>
</head>
<body>

<div id="chat">
  <div id="messages"></div>
  <input id="input" placeholder="Écrivez votre message…" style="width:80%">
  <button onclick="send()">Envoyer</button>
</div>

<script>
  // 1️⃣ Session ID invisible
  let sessionId = localStorage.getItem("session_id");
  if (!sessionId) {
    sessionId = Date.now() + "-" + Math.random().toString(36).substring(2);
    localStorage.setItem("session_id", sessionId);
  }

  const webhookUrl = "https://hook.eu1.make.com/gtp3ev2lmkcxbt8tos0rnr3q9xf6b5jg";

  function addMessage(text, cls) {
    const div = document.createElement("div");
    div.className = "msg " + cls;
    div.innerText = text;
    document.getElementById("messages").appendChild(div);
  }

  function send() {
    const input = document.getElementById("input");
    const message = input.value;
    if (!message) return;

    addMessage("Vous : " + message, "user");
    input.value = "";

    fetch(webhookUrl, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        session_id: sessionId,
        message: message
      })
    })
    .then(r => r.json())
    .then(data => {
      addMessage("IA : " + data.reply, "ia");
    });
  }
</script>

</body>
</html>
